---
layout: post
title: 读者写者问题
description: 探究简单的读者写者问题
category: blog
---

读者-写者问题是一个互斥问题的概括。互斥问题，必须满足如下条件:

* 一组并发线程想要访问一个共享对象，例如一个主存中的数据结构，或者一个磁盘上的数据库。
* 有些线程只读对象，而其他的线程修改对象。
* 写者必须有对共享对象的独占访问，而读者则可以和无限多个其他的读者共享对象
* 一般来说，有无限多个读者和写者

现实中的例子有: 共享的缓存对象、数据库中的条目

读者-写者问题有很多变种，主要是因为读者、写者之间存在一个优先级的问题；
例如，如果读者优先，则要求读者不会因为一个写者等待而等待；而如果是写者优先，则要求
一旦一个写者准备好，它就会尽可能的完成它的写操作，在一个写者后到达的读者必须等待，
即使这个写者也在等待。(秒杀项目对库存的访问应该是写优先, 还有类似的春运火车票业务)

以秒杀项目为例来构造自己的读者-写者问题的Java实现。

## 秒杀项目

### 要求

这里需要注意几个问题

* 读写操作分布在不同的线程中
* 读线程不能堵塞, 即用户查看库存不能堵着没有响应，哪怕给反馈一个过时的剩余量
* 写线程可以处于堵塞状态，但是用户在提交服务后需要立即给反馈，成功、失败、当前处于排队状态

### 设计

- 需要一个无锁的额外变量储存当前的库存量

即可以随意读取这个变量的值, 只有在写着完成后才更新该变量的值, 因此会出现当前库存量
并不是真实的数据的情况，但是这个不影响业务。
更好的是，读写线程虽然对这个额外的变量有着共享数据问题，但是由于不需要保证共享数据的
一致性，也就不存在着资源竞争.
这样问题就简化为一个写者和写者之间资源共享的问题.



