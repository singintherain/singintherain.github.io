---
layout: post
title: Spring Transaction
description: 总结Spring的Transaction处理
category: blog
---

## 单例Bean、非单例Bean、BeanFactory

通过过IOC容器的getBean方法获取的对象如果是FactoryBean类型，其生成的对象是一个BeanFactory
BeanFactory就是一个工厂，它只负责生成同种类型的Bean对象, 通过其getObject方法可以获取单个
的最终对象
本身IOC容器就是一个Bean的管理工厂，但是它负责所有类型的Bean的创建和销毁工作

## 事务和当前线程

一个事务的开启和执行是绑定到当前线程中去的
每次检查到一个新的事务声明时，它都要去检查当前的线程中是否已经有了事务
如果有则需要根据事务的传播行为来处理事务
如果没有则需要创建一个新的事务

AbstractTransactionManager提供了创建事务的模板

保存当前事务对象的详细信息的TransactionInfo对象会保存在一个ThreadLocal对象中
使用ThreadLocal对象将事务对象封闭在当前线程，每个线程都有属于自己的事务对象

事务传播行为中的事务挂起是什么意思？
支持嵌套的事务传播行为中，会先在当前的事务上下文中设置保存点，然后开启一个新的事务
客户端设置的事务隔离级别，在服务器中是如何使用这些配置的？难倒不是在服务器中统一配置事务的隔离级别吗？还是每一个事务一个隔离级别？

和Java程序采用对象锁机制进行线程同步类似，数据库管理系统采用数据库锁机制保证事务的隔离性，
当多个事务试图对相同的数据进行操作时，只有持有锁的事务才能操作数据，直到前一个事务完成后，
后面的事务才有机会对数据进行操作。

在事务的执行过程中，业务逻辑可能会报任何异常，这里可以手动控制事务的回滚


